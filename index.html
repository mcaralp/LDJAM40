<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>La péninsule la plus à l'est, C'est ça le secret! (plus ou moins)</title>

</head>
    <script src="js/pixi.min.js"></script>
    <script src="js/load.js"></script>
    <script src="js/iso.js"></script>
    <script src="js/layer.js"></script>
    <script src="js/player.js"></script>
    <script src="js/map.js"></script>
<body>
    <script type="text/javascript">
        
        let lastMovement = 0;
        function start()
        {
            const screenWidth  = 800;
            const screenHeight = 600;
          
            document.addEventListener("keydown", updateKeys);
            document.addEventListener("keyup", stopKeys);
            
            function sortBlocks(a, b)  
            {
                if(a.zIndex < b.zIndex) return -1;
                if(a.zIndex > b.zIndex) return 1;
              
                if(a.y < b.y) return -1;
                if(a.y > b.y) return 1;
                
                if(a.x > b.x) return -1;
                if(a.x > b.x) return 1;
                            
                return 0;
            }
          
            function updateKeys(event)
            {
                lastMovement = event.keyCode;
            }
            
            function stopKeys(event)
            {                
                if(event.keyCode == lastMovement)
                    lastMovement = 0;
            }

            function update(delta)
            {
                player.move(lastMovement, map);                                                
                container.children.sort(sortBlocks);

                map.setCurrentLayer(player.z);
            }

            //Create the renderer
            let app = new PIXI.Application(screenWidth, screenHeight, {backgroundColor : 'black'});
            document.body.appendChild(app.view);

            app.ticker.add(update);

            /*
            let isoCube = PIXI.Sprite.fromImage('images/placeholder.png');
            isoCube.anchor.set(0.5);

            isoCube.x = screenWidth / 2;
            isoCube.y = screenHeight / 2;
            */

            let map = ressources["map1"];
            let player = new Player();
          
            let container = new PIXI.Container(); 

            map.addToStage(container);
            player.addToStage(container);
          
            container.children.sort(sortBlocks);

            app.stage.addChild(container);
          
            container.x += 400;
            container.y += 400;
        }
        
        loadAll(start);
 
    </script>
</body>
</html>
